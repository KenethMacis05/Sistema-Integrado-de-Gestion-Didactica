
@{
    ViewBag.Title = "Usuario";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!--Titulo-->
<div class="alert text-center mt-4" style="background-color: #F7F7F7; border: 1px #D2D2D2 solid " role="alert"><h2 class="fs-3">Usuarios</h2></div>
@*<ol class="breadcrumb mb-4">
        <li class="breadcrumb-item"><a href="index.html">Dashboard</a></li>
        <li class="breadcrumb-item active">Usuarios</li>
    </ol>*@

<!--Contenedor-->
<div class="card">
    <div class="card-header pb-0 border-bottom-0">
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <!--Boton 1-->
            <li class="nav-item" role="presentation">
                <button class="nav-link active esp-link" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab" aria-controls="home" aria-selected="true">
                    <i class="fa fa-users"></i> Lista de usuarios
                </button>
            </li>
            <!--Boton 2-->
            <li class="nav-item" role="presentation">
                <button class="nav-link esp-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="false">
                    Modal
                </button>
            </li>
            <!--Boton 3-->
            <li class="nav-item" role="presentation">
                <button class="nav-link esp-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact" type="button" role="tab" aria-controls="contact" aria-selected="false">
                    Alert
                </button>
            </li>
        </ul>
    </div>
    <div class="card-body">
        <div class="tab-content" id="myTabContent">
            <!--Contenedor 1-->
            <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                <button type="button" class="btn btn-primary" onclick="abrirModal(null)"><i class="fa fa-plus"></i> Crear usuario</button>
                <hr />
                <!--Tabla-->
                <table class="display cell-border" style="width: 100%" id="datatable">
                    <thead class="table-cabezera cell-border" style="background: #0072BB; color: white">
                        <tr>
                            <th>Usuario</th>
                            <th>Nombres</th>
                            <th>Apellidos</th>
                            <th>Correo</th>
                            <th>Activo</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                    <tfoot>

                    </tfoot>
                </table>

                <!-- Modal -->
                <div class="modal fade modal-lg" id="createUser" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header text-light" style="background-color: #0072BB">
                                <h5 class="modal-title" id="exampleModalLabel">Usuario</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body g-2">
                                
                                    <input type="text" name="idUsuario" id="idUsuario" value="0">
                                    <div class="row">
                                        <div class="col-lg-3 mb-3">
                                            <label class="form-label" for="priNombre">Primer nombre</label>
                                            <input type="text" class="form-control" id="priNombre" name="priNombre" required>
                                        </div>
                                        <div class="col-lg-3 mb-3">
                                            <label class="form-label" for="segNombre">Segundo nombre</label>
                                            <input type="text" class="form-control" id="segNombre" name="segNombre">
                                        </div>
                                        <div class="col-lg-3 mb-3">
                                            <label class="form-label" for="priApellido">Primer apellido</label>
                                            <input type="text" class="form-control" id="priApellido" name="priApellido" required>
                                        </div>
                                        <div class="col-lg-3 mb-3">
                                            <label class="form-label" for="segApellido">Segundo apellido</label>
                                            <input type="text" class="form-control" id="segApellido" name="segApellido">
                                        </div>
                                        <div class="col-lg-6 mb-3">
                                            <label class="form-label" for="usuario">Usuario</label>
                                            <div class="input-group flex-nowrap">
                                                <span class="input-group-text"><i class="fa fa-user"></i></span>
                                                <input type="text" class="form-control" id="usuario" name="usuario" placeholder="Ingrese el usuario" required>
                                            </div>
                                        </div>
                                        <div class="col-lg-6 mb-3">
                                            <label class="form-label" for="contrasena">Contraseña</label>
                                            <div class="input-group flex-nowrap">
                                                <span class="input-group-text" id="nose"><i class="fas fa-key fs-5"></i></span>
                                                <input type="password" class="form-control" id="contrasena" name="contrasena" placeholder="Ingrese la contraseña" required>
                                            </div>
                                        </div>
                                        <div class="col-lg-6 mb-3">
                                            <label class="form-label" for="correo">Correo</label>
                                            <div class="input-group mb-3">
                                                <input type="email" class="form-control" id="correo" name="correo" aria-describedby="correo" required>
                                                <span class="input-group-text" id="correo">gmail.com</span>
                                            </div>
                                        </div>
                                        <div class="col-lg-6 mb-3">
                                            <label class="form-label" for="rol">Rol</label>
                                            <div class="input-group mb-3">
                                                <label class="input-group-text" for="rol">Optiones</label>
                                                <select class="form-select" id="rol">
                                                    <option selected value="1">Administrador</option>
                                                    <option value="2">Integrador</option>
                                                    <option value="3">Docente</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-lg-6 mb-3">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" role="switch" id="estado" checked required>
                                                <label class="form-check-label" for="estado">Estado Inactivo/Activo</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer pe-0 ps-0 flex-nowrap ">
                                        <button type="button" class="btn btn-danger w-50" data-bs-dismiss="modal">
                                            <i class="fas fa-times-circle me-2"></i>Cerrar
                                        </button>
                                        <button type="submit" onclick="Guardar()" class="btn btn-success w-50">
                                            <i class="fas fa-save me-2"></i>Guardar
                                        </button>
                                    </div>
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--Contenedor 2-->
            <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">

            </div>
            <!--Contenedor 3-->
            <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
                <button type="button" onclick="alertDeleteUser()" class="btn btn-danger">Eliminar</button>
                <button type="button" class="btn btn-warning" id="alertWarning">Advertencia</button>
                <button type="button" class="btn btn-danger" id="alertErrorDeleteUser">Error</button>
                <button type="button" class="btn btn-success" id="alertCreateUser">Éxito</button>
                <button type="button" class="btn btn-info" id="alertInfo">Información</button>
                <button type="button" class="btn btn-info" id="alertErrorDataBase">Información</button>
            </div>
        </div>
    </div>
</div>

@section scripts{
    <script>
        var filaSeleccionada

        function abrirModal(json) {
            $("#idUsuario").val("0");
            $("#usuario").val("");
            $("#correo").val("");
            $("#contrasena").val("");
            $("#priNombre").val("");
            $("#priApellido").val("");

            // Configurar el checkbox
            $("#estado").prop("checked");

            if (json !== null) {
                $("#idUsuario").val(json.id_usuario);
                $("#usuario").val(json.usuario);
                $("#correo").val(json.correo);
                $("#contrasena").val(json.contrasena);
                $("#priNombre").val(json.nombre);
                $("#priApellido").val(json.apellido);

                // Configurar el checkbox
                $("#estado").prop("checked", json.estado === true);
            }

            $("#createUser").modal("show");
        }

        $("#datatable tbody").on("click", '.btn-editar', function () {
            filaSeleccionada = $(this).closest("tr");

            var data = dataTable.row(filaSeleccionada).data()

            abrirModal(data)
        });

        function Guardar() {
            var Usuario = {
                id_usuario: $("#idUsuario").val(),
                nombre: $("#priNombre").val(),
                apellido: $("#priApellido").val(),
                usuario: $("#usuario").val(),
                contrasena: $("#contrasena").val(),
                correo: $("#correo").val(),
                estado: $("#estado").prop("checked")
            };

            if (Usuario.id_usuario == 0) {
                dataTable.row.add(Usuario).draw(false)
            } else {
                dataTable.row(filaSeleccionada).data(Usuario)
            }
        }




jQuery.ajax({
        url: '@Url.Action("ListarUsuarios", "Home")',
        type: "GET",
        dataType: "json",
        contentType: "application/json; charset=utf-8",
        success: function (data) {
            console.log(data)
        }
    })

let dataTable;

const dataTableOptions = {
    lengthMenu: [5, 10, 15, 20, 100, 200, 500],
    pageLength: 5,
    destroy: true,
    language: {
        lengthMenu: "Mostrar _MENU_ registros por página",
        zeroRecords: "Ningún usuario encontrado",
        info: "Mostrando de _START_ a _END_ de un total de _TOTAL_ registros",
        infoEmpty: "Ningún usuario encontrado",
        infoFiltered: "(filtrados desde _MAX_ registros totales)",
        search: "Buscar:",
        loadingRecords: "Cargando...",
        paginate: {
            first: "Primero",
            last: "Último",
            next: "Siguiente",
            previous: "Anterior"
        }
    },
    responsive: true,
    ordering: false,
    ajax: {
        url: '@Url.Action("ListarUsuarios", "Home")',
        type: "GET",
        dataType: "json"
    },
    columns: [
        { data: "usuario" },
        { data: "pri_nombre" },
        { data: "pri_apellido" },
        { data: "correo" },
        {
            data: "estado",
            render: function (valor) {
                return valor
                    ? "<div class='d-flex justify-content-center align-items-center'><span class='badge text-bg-success'>SI</span></div>"
                    : "<div class='d-flex justify-content-center align-items-center'><span class='badge text-bg-danger'>NO</span></div>";
            },
            width: "90"
        },
        {
            defaultContent:
                '<button type="button" class="btn btn-primary btn-sm btn-editar"><i class="fa fa-pen"></i></button>' +
                '<button type="button" class="btn btn-danger btn-sm ms-2 btn-eliminar"><i class="fa fa-trash"></i></button>',
            width: "90"
        }
    ]
};

$(document).ready(function () {
    dataTable = $("#datatable").DataTable(dataTableOptions);
});

        $(document).ready(function () {
            dataTable = $("#datatable").DataTable(dataTableOptions);
        });
    </script>
}